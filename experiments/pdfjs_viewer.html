<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>PDF.js — Simple Viewer</title>
  <style>
    :root{--gap:12px;--btn:#1f6feb}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;display:flex;flex-direction:column;gap:var(--gap);padding:18px;background:#f6f8fb;color:#0b1220}
    header{display:flex;gap:12px;align-items:center}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button,input,select{padding:8px 10px;border-radius:8px;border:1px solid #d6dbe8;background:white}
    button{cursor:pointer}
    button.primary{background:var(--btn);color:white;border:none}
    #canvasContainer{flex:1;display:flex;justify-content:center;align-items:center;padding:8px;border-radius:10px;background:white;box-shadow:0 6px 18px rgba(12,20,40,0.06)}
    canvas{max-width:100%;height:auto}
    footer{font-size:13px;color:#445}
    label{font-size:13px}
    .spacer{width:12px}
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;font-size:18px">PDF.js — Simple Viewer</h1>
    <div class="spacer"></div>
    <div class="controls" role="toolbar" aria-label="PDF controls">
      <input id="fileInput" type="file" accept="application/pdf" aria-label="Open PDF file">
      <input id="urlInput" type="url" placeholder="Or enter PDF URL" style="min-width:260px">
      <button id="openUrl">Open URL</button>
      <button id="prevPage">◀ Prev</button>
      <button id="nextPage">Next ▶</button>
      <label>Page <input id="pageNum" type="number" min="1" value="1" style="width:68px"> / <span id="pageCount">0</span></label>
      <button id="zoomOut">−</button>
      <button id="zoomIn" class="primary">+</button>
      <label>Scale <select id="scaleSelect">
        <option>0.5</option>
        <option>0.75</option>
        <option selected>1.0</option>
        <option>1.25</option>
        <option>1.5</option>
        <option>2.0</option>
      </select></label>
      <button id="rotate">⤾ Rotate</button>
      <button id="download">Download</button>
      <button id="print">Print</button>
    </div>
  </header>

  <main id="canvasContainer">
    <canvas id="pdfCanvas" role="img" aria-label="PDF page canvas"></canvas>
  </main>

  <footer>
    Demo viewer using PDF.js (pdfjs-dist). Works with local files or remote PDF URLs. Save this file as <code>pdfjs-viewer.html</code> and open in your browser.
  </footer>

 <script type="module">
import pdfjsDist from 'https://cdn.jsdelivr.net/npm/pdfjs-dist@5.4.296/+esm'
</script>

  <script type="module">
        import * as pdfjsLib from "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/5.4.149/pdf.min.mjs";

    // Set workerSrc to the same library's worker file on CDN
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/5.4.149/pdf.worker.min.mjs";

    // App elements
    const fileInput = document.getElementById('fileInput');
    const urlInput = document.getElementById('urlInput');
    const openUrlBtn = document.getElementById('openUrl');
    const canvas = document.getElementById('pdfCanvas');
    const ctx = canvas.getContext('2d');
    const prevBtn = document.getElementById('prevPage');
    const nextBtn = document.getElementById('nextPage');
    const pageNumEl = document.getElementById('pageNum');
    const pageCountEl = document.getElementById('pageCount');
    const zoomIn = document.getElementById('zoomIn');
    const zoomOut = document.getElementById('zoomOut');
    const scaleSelect = document.getElementById('scaleSelect');
    const rotateBtn = document.getElementById('rotate');
    const downloadBtn = document.getElementById('download');
    const printBtn = document.getElementById('print');

    // PDF state
    let pdfDoc = null;
    let currentPage = 1;
    let currentScale = parseFloat(scaleSelect.value) || 1.0;
    let rotation = 0; // degrees: 0,90,180,270
    let pageRendering = false;
    let pageNumPending = null;

    // Render a page
    async function renderPage(num) {
      pageRendering = true;
      const page = await pdfDoc.getPage(num);
      const viewport = page.getViewport({ scale: currentScale, rotation });

      // High-DPI support: scale the canvas backing store
      const outputScale = window.devicePixelRatio || 1;
      canvas.width = Math.floor(viewport.width * outputScale);
      canvas.height = Math.floor(viewport.height * outputScale);
      canvas.style.width = Math.floor(viewport.width) + 'px';
      canvas.style.height = Math.floor(viewport.height) + 'px';

      const transform = outputScale !== 1 ? [outputScale, 0, 0, outputScale, 0, 0] : null;
      const renderContext = { canvasContext: ctx, viewport, transform };
      const renderTask = page.render(renderContext);
      await renderTask.promise;
      pageRendering = false;

      // If another page was requested while rendering, render it now
      if (pageNumPending !== null) {
        renderPage(pageNumPending);
        pageNumPending = null;
      }
    }

    function queueRenderPage(num) {
      if (pageRendering) {
        pageNumPending = num;
      } else {
        renderPage(num);
      }
    }

    function onPrevPage() {
      if (currentPage <= 1) return;
      currentPage--;
      pageNumEl.value = currentPage;
      queueRenderPage(currentPage);
    }

    function onNextPage() {
      if (currentPage >= pdfDoc.numPages) return;
      currentPage++;
      pageNumEl.value = currentPage;
      queueRenderPage(currentPage);
    }

    // Load PDF from ArrayBuffer (local file) or URL
    async function loadDocument(source) {
      try {
        // Reset rotation/scale when loading a new doc? we keep scale
        pdfDoc = await pdfjsLib.getDocument(source).promise;
        pageCountEl.textContent = pdfDoc.numPages;
        currentPage = 1;
        pageNumEl.value = 1;
        queueRenderPage(currentPage);
      } catch (err) {
        alert('Failed to load PDF:\n' + (err && err.message ? err.message : err));
        console.error(err);
      }
    }

    // File input handler
    fileInput.addEventListener('change', async (evt) => {
      const file = evt.target.files && evt.target.files[0];
      if (!file) return;
      const arrayBuffer = await file.arrayBuffer();
      // supply typed array for pdf.js
      loadDocument({ data: arrayBuffer });
    });

    // Open URL handler
    openUrlBtn.addEventListener('click', () => {
      const url = urlInput.value.trim();
      if (!url) return alert('Enter a valid PDF URL');
      // Note: some remote servers may block cross-origin requests.
      loadDocument(url);
    });

    // Page controls
    prevBtn.addEventListener('click', onPrevPage);
    nextBtn.addEventListener('click', onNextPage);

    pageNumEl.addEventListener('change', () => {
      let val = Number(pageNumEl.value);
      if (!val || val < 1) val = 1;
      if (val > pdfDoc.numPages) val = pdfDoc.numPages;
      currentPage = val;
      pageNumEl.value = val;
      queueRenderPage(val);
    });

    // Zoom controls
    zoomIn.addEventListener('click', () => {
      currentScale = currentScale + 0.25;
      scaleSelect.value = currentScale.toFixed(2);
      queueRenderPage(currentPage);
    });
    zoomOut.addEventListener('click', () => {
      currentScale = Math.max(0.25, currentScale - 0.25);
      scaleSelect.value = currentScale.toFixed(2);
      queueRenderPage(currentPage);
    });
    scaleSelect.addEventListener('change', () => {
      currentScale = parseFloat(scaleSelect.value) || 1.0;
      queueRenderPage(currentPage);
    });

    // Rotate
    rotateBtn.addEventListener('click', () => {
      rotation = (rotation + 90) % 360;
      queueRenderPage(currentPage);
    });

    // Download: render the whole PDF blob and create a download link
    downloadBtn.addEventListener('click', async () => {
      try {
        if (!pdfDoc) return alert('No PDF loaded');
        // If originally loaded from a URL, try to fetch it again as blob
        // If loaded from file input, we don't have the original file blob here — but the fetch from pdfDoc._transport may provide data.
        // Simplest robust approach: use the original source if available on urlInput, otherwise re-render page-by-page into a Blob is complex.
        if (urlInput.value.trim()) {
          const resp = await fetch(urlInput.value.trim());
          const blob = await resp.blob();
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'document.pdf';
          a.click();
          URL.revokeObjectURL(a.href);
        } else {
          alert('Download of local file is handled by your browser (open file menu). If you opened a URL, use the URL field to download.')
        }
      } catch (err) {
        console.error(err);
        alert('Download failed: ' + (err && err.message ? err.message : err));
      }
    });

    // Print: open a new window with the canvas image and call print()
    printBtn.addEventListener('click', async () => {
      if (!pdfDoc) return alert('No PDF loaded');
      // Best-effort: print current page as image
      const dataUrl = canvas.toDataURL();
      const w = window.open('');
      w.document.write('<img src="'+dataUrl+'" style="max-width:100%">');
      w.document.close();
      w.focus();
      w.print();
    });

    // Accessibility: keyboard navigation for page changes
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') onPrevPage();
      if (e.key === 'ArrowRight') onNextPage();
      if (e.key === '+' || e.key === '=') { currentScale += 0.25; scaleSelect.value = currentScale.toFixed(2); queueRenderPage(currentPage); }
      if (e.key === '-') { currentScale = Math.max(0.25, currentScale - 0.25); scaleSelect.value = currentScale.toFixed(2); queueRenderPage(currentPage); }
    });

    // Example: load a sample PDF by default (uncomment to enable)
    // loadDocument('https://example.com/sample.pdf');

    // Minimal feature: when a document is loaded we set pageCount and render first page.

    // Expose for debugging
    window._pdfViewer = { loadDocument, pdfjsLib, pdfDoc: () => pdfDoc };
  </script>
</body>
</html>
